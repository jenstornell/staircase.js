class Staircase{constructor(e){this.o=Object.assign({},this.defaults(),e)}load(){document.addEventListener("DOMContentLoaded",()=>{document.querySelector(this.o.selector).dataset.scName="/",console.log("test"),this.ajax("/")})}defaults(){return{ajaxPath:"ajax.php",selector:"stair-case",fetchParams:{method:"POST",headers:{"Content-Type":"application/json"}}}}$(e){let t=document.querySelectorAll(e);return 0==t.length?null:1==t.length?t[0]:t}ajax(e){let t={},s=this.o.fetchParams;t.id=e;let a=JSON.stringify(t),c=this.$(this.o.selector+'[data-sc-name="'+e+'"], '+this.o.selector+' [data-sc-name="'+e+'"]');c.classList.add("sc-loading"),s.body=a,fetch(this.o.ajaxPath,s).then(e=>e.text()).then(t=>{c.classList.remove("sc-loading");let s={};if(s.id=e,s.element=c,this.isJson(t)){let a=JSON.parse(t),c=this.createList(a,e),l=this.$(this.o.selector+'[data-sc-name="'+e+'"],'+this.o.selector+' [data-sc-name="'+e+'"]');l.appendChild(c),l.dataset.scChildren="",l.dataset.scState="open",this.eventClickName(e),this.eventClickFolder(l),this.eventClickToggle(l),s.success=!0}else s.success=!1;"function"==typeof this.o.callbacks.load&&this.o.callbacks.select(s)})}isJson(e){try{JSON.parse(e)}catch(e){return!1}return!0}createList(e,t){let s=document.createElement("ul"),a=this.toFilesFolders(e);return s.dataset.scChildren="",a.folders.forEach(e=>{let a=this.createLi(e),c=this.trimSlashes(t+"/"+e);a.dataset.scType="folder",a.dataset.scName=c,s.appendChild(a)}),a.files.forEach(e=>{let a=this.createLi(e),c=this.trimSlashes(t+"/"+e);a.dataset.scType="file",a.dataset.scName=c,s.appendChild(a)}),s}createLi(e){let t=document.createElement("li"),s=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),l=document.createTextNode(e);return a.classList.add("sc-icon"),c.classList.add("sc-name"),s.classList.add("sc-current"),c.appendChild(l),s.appendChild(a),s.appendChild(c),t.appendChild(s),t}toFilesFolders(e){let t=[];t.folders=[],t.files=[];let s=0;return e.forEach(e=>{this.isFolder(e)?t.folders[s]=e.slice(0,-1):t.files[s]=e,s++}),t.folders.sort(),t.files.sort(),t}isFolder(e){return"/"==e[e.length-1]}eventClickName(e){let t=this.o.selector+'[data-sc-name="'+e+'"] > ul > li > .sc-current > .sc-name'+", "+(this.o.selector+' [data-sc-name="'+e+'"] > ul > li > .sc-current > .sc-name');document.querySelectorAll(t).forEach(e=>{e.addEventListener("click",e=>{let t=e.currentTarget.closest("li"),s=this.setData(t);this.removeActive(),this.setActive(t),"function"==typeof this.o.callbacks.select&&this.o.callbacks.select(s)})})}eventClickToggle(e){let t=e.dataset.scName,s=this.$(this.o.selector+'[data-sc-name="'+t+'"] > .sc-current > .sc-icon,'+this.o.selector+' [data-sc-name="'+t+'"] > .sc-current > .sc-icon');s&&s.addEventListener("click",t=>{let s=t.currentTarget.closest("li"),a=this.setData(s);"open"==e.dataset.scState?e.dataset.scState="close":e.dataset.scState="open",a.state=e.dataset.scState,"function"==typeof this.o.callbacks.toggle&&this.o.callbacks.toggle(a)})}eventClickFolder(e){e.querySelectorAll('li[data-sc-type="folder"]:not([data-sc-children]) .sc-icon').forEach(e=>{e.addEventListener("click",e=>{let t=e.currentTarget.closest("[data-sc-name]");if(void 0===t.dataset.scChildren){let e=t.dataset.scName,s=this.trimSlashes(e);this.ajax(s)}},!0)})}trimSlashes(e){return e.replace(/^\/+|\/+$/g,"")}setData(e){let t={};return t.id=e.dataset.scName,t.element=e,t.type=e.dataset.scType,t}removeActive(){this.$(this.o.selector+" li").forEach(function(e){delete e.dataset.scActive})}setActive(e){e.dataset.scActive=""}}function staircase(e){new Staircase(e).load(e)}
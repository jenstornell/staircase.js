var staircase=function(){var e,t={},a={};return t.init=function(c){a=Object.assign({},t.defaults(),c),e=t.$,document.addEventListener("DOMContentLoaded",function(e){document.querySelector(a.selector).dataset.scName="/",t.ajax("/")})},t.defaults=function(){return{ajaxPath:"ajax.php",selector:"stair-case",fetchParams:{method:"POST",headers:{"Content-Type":"application/json"}}}},t.$=function(e){let t=document.querySelectorAll(e);return 0==t.length?null:1==t.length?t[0]:t},t.ajax=function(c){let n={},s=a.fetchParams;n.id=c;let i=JSON.stringify(n),l=e(a.selector+'[data-sc-name="'+c+'"], '+a.selector+' [data-sc-name="'+c+'"]');l.classList.add("sc-loading"),s.body=i,fetch(a.ajaxPath,s).then(function(e){return e.text()}).then(function(n){l.classList.remove("sc-loading");let s={};if(s.id=c,s.element=l,t.isJson(n)){let i=JSON.parse(n),l=t.createList(i,c),r=e(a.selector+'[data-sc-name="'+c+'"],'+a.selector+' [data-sc-name="'+c+'"]');r.appendChild(l),r.dataset.scChildren="",r.dataset.scState="open",t.eventClickName(),t.eventClickFolder(r),t.eventClickToggle(r),s.success=!0}else s.success=!1;a.callbackAfterLoad(s)})},t.isJson=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},t.createList=function(e,a){let c=document.createElement("ul"),n=t.toFilesFolders(e);return c.dataset.scChildren="",n.folders.forEach(function(e){let n=t.createLi(e),s=t.trimSlashes(a+"/"+e);n.dataset.scType="folder",n.dataset.scName=s,c.appendChild(n)}),n.files.forEach(function(e){let n=t.createLi(e),s=t.trimSlashes(a+"/"+e);n.dataset.scType="file",n.dataset.scName=s,c.appendChild(n)}),c},t.createLi=function(e){let t=document.createElement("li"),a=document.createElement("div"),c=document.createElement("div"),n=document.createElement("div"),s=document.createTextNode(e);return c.classList.add("sc-icon"),n.classList.add("sc-name"),a.classList.add("sc-current"),n.appendChild(s),a.appendChild(c),a.appendChild(n),t.appendChild(a),t},t.toFilesFolders=function(e){let a=[];a.folders=[],a.files=[];let c=0;return e.forEach(function(e){t.isFolder(e)?a.folders[c]=e.slice(0,-1):a.files[c]=e,c++}),a.folders.sort(),a.files.sort(),a},t.isFolder=function(e){return"/"==e[e.length-1]},t.eventClickName=function(){e(a.selector+" li .sc-name").forEach(function(e){e.addEventListener("click",function(e){let c=e.currentTarget.closest("li"),n=t.setData(c);t.removeActive(),t.setActive(c),a.callbackActive(n)})})},t.eventClickToggle=function(t){let c=t.dataset.scName,n=e(a.selector+'[data-sc-name="'+c+'"] > .sc-current > .sc-icon,'+a.selector+' [data-sc-name="'+c+'"] > .sc-current > .sc-icon');n&&n.addEventListener("click",function(e){"open"==t.dataset.scState?t.dataset.scState="close":t.dataset.scState="open"})},t.eventClickFolder=function(e){e.querySelectorAll('li[data-sc-type="folder"]:not([data-sc-children]) .sc-icon').forEach(function(e){e.addEventListener("click",function(e){let a=e.currentTarget.closest("[data-sc-name]");if(void 0===a.dataset.scChildren){let e=a.dataset.scName;id=t.trimSlashes(e),t.ajax(id)}},!0)})},t.trimSlashes=function(e){return e.replace(/^\/+|\/+$/g,"")},t.setData=function(e){let t={};return t.id=e.dataset.scName,t.element=e,t.type=e.dataset.scType,t},t.removeActive=function(){e(a.selector+" li").forEach(function(e){delete e.dataset.scActive})},t.setActive=function(e){e.dataset.scActive=""},t}();
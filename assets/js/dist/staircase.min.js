var staircase=function(){var e,t={},c={};return t.init=function(a){c=Object.assign({},t.defaults(),a),e=t.$,document.addEventListener("DOMContentLoaded",function(e){document.querySelector(c.selector).dataset.scName="/",t.ajax("/")})},t.defaults=function(){return{ajaxPath:"ajax.php",selector:"stair-case",fetchParams:{method:"POST",headers:{"Content-Type":"application/json"}}}},t.$=function(e){let t=document.querySelectorAll(e);return 0==t.length?null:1==t.length?t[0]:t},t.ajax=function(a){let s={},n=c.fetchParams;s.id=a;let l=JSON.stringify(s),i=e(c.selector+'[data-sc-name="'+a+'"], '+c.selector+' [data-sc-name="'+a+'"]');i.classList.add("sc-loading"),n.body=l,fetch(c.ajaxPath,n).then(function(e){return e.text()}).then(function(s){i.classList.remove("sc-loading");let n={};if(n.id=a,n.element=i,t.isJson(s)){let l=JSON.parse(s),i=t.createList(l,a),r=e(c.selector+'[data-sc-name="'+a+'"],'+c.selector+' [data-sc-name="'+a+'"]');r.appendChild(i),r.dataset.scChildren="",r.dataset.scState="open",t.eventClickName(a),t.eventClickFolder(r),t.eventClickToggle(r),n.success=!0}else n.success=!1;"function"==typeof c.callbacks.load&&c.callbacks.select(n)})},t.isJson=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},t.createList=function(e,c){let a=document.createElement("ul"),s=t.toFilesFolders(e);return a.dataset.scChildren="",s.folders.forEach(function(e){let s=t.createLi(e),n=t.trimSlashes(c+"/"+e);s.dataset.scType="folder",s.dataset.scName=n,a.appendChild(s)}),s.files.forEach(function(e){let s=t.createLi(e),n=t.trimSlashes(c+"/"+e);s.dataset.scType="file",s.dataset.scName=n,a.appendChild(s)}),a},t.createLi=function(e){let t=document.createElement("li"),c=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div"),n=document.createTextNode(e);return a.classList.add("sc-icon"),s.classList.add("sc-name"),c.classList.add("sc-current"),s.appendChild(n),c.appendChild(a),c.appendChild(s),t.appendChild(c),t},t.toFilesFolders=function(e){let c=[];c.folders=[],c.files=[];let a=0;return e.forEach(function(e){t.isFolder(e)?c.folders[a]=e.slice(0,-1):c.files[a]=e,a++}),c.folders.sort(),c.files.sort(),c},t.isFolder=function(e){return"/"==e[e.length-1]},t.eventClickName=function(e){let a=c.selector+'[data-sc-name="'+e+'"] > ul > li > .sc-current > .sc-name'+", "+(c.selector+' [data-sc-name="'+e+'"] > ul > li > .sc-current > .sc-name');document.querySelectorAll(a).forEach(function(e){e.addEventListener("click",function(e){let a=e.currentTarget.closest("li"),s=t.setData(a);t.removeActive(),t.setActive(a),"function"==typeof c.callbacks.select&&c.callbacks.select(s)})})},t.eventClickToggle=function(a){let s=a.dataset.scName,n=e(c.selector+'[data-sc-name="'+s+'"] > .sc-current > .sc-icon,'+c.selector+' [data-sc-name="'+s+'"] > .sc-current > .sc-icon');n&&n.addEventListener("click",function(e){let s=e.currentTarget.closest("li"),n=t.setData(s);"open"==a.dataset.scState?a.dataset.scState="close":a.dataset.scState="open",n.state=a.dataset.scState,"function"==typeof c.callbacks.toggle&&c.callbacks.toggle(n)})},t.eventClickFolder=function(e){e.querySelectorAll('li[data-sc-type="folder"]:not([data-sc-children]) .sc-icon').forEach(function(e){e.addEventListener("click",function(e){let c=e.currentTarget.closest("[data-sc-name]");if(void 0===c.dataset.scChildren){let e=c.dataset.scName;id=t.trimSlashes(e),t.ajax(id)}},!0)})},t.trimSlashes=function(e){return e.replace(/^\/+|\/+$/g,"")},t.setData=function(e){let t={};return t.id=e.dataset.scName,t.element=e,t.type=e.dataset.scType,t},t.removeActive=function(){e(c.selector+" li").forEach(function(e){delete e.dataset.scActive})},t.setActive=function(e){e.dataset.scActive=""},t}();